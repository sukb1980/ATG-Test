import{r as N,j as a,a as ls,R as cs,b as hs,c as us,d as fs,s as ds}from"./index-CqPkO4w-.js";const be=[{label:"Sales Growth %",color:"#FF6B6B",value:"+12.5%"},{label:"Conversion Rate",color:"#4ECDC4",value:"4.2%"},{label:"Mystery Audit",color:"#45B7D1",value:"92/100"},{label:"NPS Score",color:"#96CEB4",value:"78"},{label:"VM Compliance",color:"#FFEEAD",value:"98%"},{label:"Inventory Turn",color:"#D4A5A5",value:"6.5x"}];function vt(){const[r,t]=N.useState(!1),[e,s]=N.useState(0),[i,o]=N.useState(null),f=()=>{if(r)return;t(!0),o(null);const c=Math.floor(Math.random()*360)+1440,p=e+c;s(p),setTimeout(()=>{t(!1);const d=p%360,m=Math.floor((360-d)/(360/be.length))%be.length;o(be[m])},4e3)};return a.jsxs("div",{className:"wheel-container",children:[a.jsx("h2",{className:"game-title",children:"Retail Premier League"}),a.jsxs("div",{className:"wheel-wrapper",children:[a.jsx("div",{className:"wheel-pointer"}),a.jsx("div",{className:`wheel ${r?"spinning":""}`,style:{transform:`rotate(${e}deg)`},children:be.map((c,p)=>a.jsx("div",{className:"wheel-segment",style:{"--i":p,"--clr":c.color,"--total":be.length},children:a.jsx("span",{className:"segment-text",children:c.label})},p))}),a.jsx("button",{className:"spin-button",onClick:f,disabled:r,children:r?"...":"SPIN"})]}),i&&a.jsxs("div",{className:"result-popup fade-in",children:[a.jsx("h3",{children:i.label}),a.jsx("div",{className:"result-value",children:i.value}),a.jsx("p",{children:"Top Performance this month!"})]})]})}const ps=[{label:"Donations Collected",value:"$12,450",icon:"volunteer_activism"},{label:"Trees Planted",value:"450",icon:"park"},{label:"Meals Distributed",value:"1,200",icon:"restaurant"},{label:"Volunteer Hours",value:"320",icon:"schedule"},{label:"Water Bottles Recycled",value:"5,000",icon:"recycling"},{label:"Kindness Notes Shared",value:"850",icon:"favorite"}];function gs(){const[r,t]=N.useState(!1),[e,s]=N.useState(1),[i,o]=N.useState(null),f=()=>{if(r)return;t(!0),o(null);const c=Math.floor(Math.random()*6)+1;setTimeout(()=>{s(c),t(!1),o(ps[c-1])},1500)};return a.jsxs("div",{className:"dice-container",children:[a.jsx("h2",{className:"game-title",children:"Ramadan Kindness Quest"}),a.jsx("div",{className:"dice-scene",children:a.jsxs("div",{className:`dice ${r?"rolling":""}`,"data-side":e,children:[a.jsx("div",{className:"side one",children:a.jsx("div",{className:"dot"})}),a.jsxs("div",{className:"side two",children:[a.jsx("div",{className:"dot"}),a.jsx("div",{className:"dot"})]}),a.jsxs("div",{className:"side three",children:[a.jsx("div",{className:"dot"}),a.jsx("div",{className:"dot"}),a.jsx("div",{className:"dot"})]}),a.jsxs("div",{className:"side four",children:[a.jsx("div",{className:"dot"}),a.jsx("div",{className:"dot"}),a.jsx("div",{className:"dot"}),a.jsx("div",{className:"dot"})]}),a.jsxs("div",{className:"side five",children:[a.jsx("div",{className:"dot"}),a.jsx("div",{className:"dot"}),a.jsx("div",{className:"dot"}),a.jsx("div",{className:"dot"}),a.jsx("div",{className:"dot"})]}),a.jsxs("div",{className:"side six",children:[a.jsx("div",{className:"dot"}),a.jsx("div",{className:"dot"}),a.jsx("div",{className:"dot"}),a.jsx("div",{className:"dot"}),a.jsx("div",{className:"dot"}),a.jsx("div",{className:"dot"})]})]})}),a.jsx("button",{className:"roll-button",onClick:f,disabled:r,children:r?"ROLLING...":"ROLL DICE"}),i&&a.jsxs("div",{className:"quest-result fade-in",children:[a.jsx("span",{className:"material-symbols-outlined quest-icon",children:i.icon}),a.jsx("h3",{children:i.label}),a.jsx("div",{className:"quest-value",children:i.value}),a.jsx("p",{children:"Subhan Allah! Keep it up!"})]})]})}const ms=[{title:"Paper Wastage",value:"15%",goal:"5%",icon:"description",color:"#ff6b6b",desc:"Lower is better"},{title:"Energy Consumed",value:"420 kWh",goal:"350 kWh",icon:"bolt",color:"#ffd700",desc:"Monthly store average"},{title:"Recycling Rate",value:"68%",goal:"85%",icon:"recycling",color:"#4ecdc4",desc:"Targeting zero waste"}];function _s(){return a.jsxs("div",{className:"sustainability-container",children:[a.jsx("h2",{className:"game-title",children:"Sustainability Mission"}),a.jsx("div",{className:"metrics-grid",children:ms.map((r,t)=>a.jsxs("div",{className:"metric-card",style:{"--accent":r.color},children:[a.jsxs("div",{className:"metric-header",children:[a.jsx("span",{className:"material-symbols-outlined metric-icon",children:r.icon}),a.jsx("h3",{children:r.title})]}),a.jsxs("div",{className:"metric-body",children:[a.jsxs("div",{className:"value-display",children:[a.jsx("span",{className:"current-value",children:r.value}),a.jsxs("span",{className:"goal-label",children:["Goal: ",r.goal]})]}),a.jsx("div",{className:"progress-bar-bg",children:a.jsx("div",{className:"progress-bar-fill",style:{width:t===0?"75%":t===1?"85%":"68%"}})}),a.jsx("p",{className:"metric-desc",children:r.desc})]})]},t))}),a.jsxs("div",{className:"mission-footer",children:[a.jsx("p",{children:"Every small step counts towards a greener future."}),a.jsx("button",{className:"pledge-button",children:"Take the Pledge"})]})]})}function vs(r){return r!==null?{comment:r,variations:[]}:{variations:[]}}function bs(r,t,e,s,i){const o={move:r,variations:i};return t&&(o.suffix=t),e&&(o.nag=e),s!==null&&(o.comment=s),o}function xs(...r){const[t,...e]=r;let s=t;for(const i of e)i!==null&&(s.variations=[i,...i.variations],i.variations=[],s=i);return t}function ys(r,t){if(t.marker&&t.marker.comment){let e=t.root;for(;;){const s=e.variations[0];if(!s){e.comment=t.marker.comment;break}e=s}}return{headers:r,root:t.root,result:(t.marker&&t.marker.result)??void 0}}function ws(r,t){function e(){this.constructor=r}e.prototype=t.prototype,r.prototype=new e}function de(r,t,e,s){var i=Error.call(this,r);return Object.setPrototypeOf&&Object.setPrototypeOf(i,de.prototype),i.expected=t,i.found=e,i.location=s,i.name="SyntaxError",i}ws(de,Error);function Ue(r,t,e){return e=e||" ",r.length>t?r:(t-=r.length,e+=e.repeat(t),r+e.slice(0,t))}de.prototype.format=function(r){var t="Error: "+this.message;if(this.location){var e=null,s;for(s=0;s<r.length;s++)if(r[s].source===this.location.source){e=r[s].text.split(/\r\n|\n|\r/g);break}var i=this.location.start,o=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(i):i,f=this.location.source+":"+o.line+":"+o.column;if(e){var c=this.location.end,p=Ue("",o.line.toString().length," "),d=e[i.line-1],m=i.line===c.line?c.column:d.length+1,y=m-i.column||1;t+=`
 --> `+f+`
`+p+` |
`+o.line+" | "+d+`
`+p+" | "+Ue("",i.column-1," ")+Ue("",y,"^")}else t+=`
 at `+f}return t};de.buildMessage=function(r,t){var e={literal:function(d){return'"'+i(d.text)+'"'},class:function(d){var m=d.parts.map(function(y){return Array.isArray(y)?o(y[0])+"-"+o(y[1]):o(y)});return"["+(d.inverted?"^":"")+m.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(d){return d.description}};function s(d){return d.charCodeAt(0).toString(16).toUpperCase()}function i(d){return d.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(m){return"\\x0"+s(m)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(m){return"\\x"+s(m)})}function o(d){return d.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(m){return"\\x0"+s(m)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(m){return"\\x"+s(m)})}function f(d){return e[d.type](d)}function c(d){var m=d.map(f),y,g;if(m.sort(),m.length>0){for(y=1,g=1;y<m.length;y++)m[y-1]!==m[y]&&(m[g]=m[y],g++);m.length=g}switch(m.length){case 1:return m[0];case 2:return m[0]+" or "+m[1];default:return m.slice(0,-1).join(", ")+", or "+m[m.length-1]}}function p(d){return d?'"'+i(d)+'"':"end of input"}return"Expected "+c(r)+" but "+p(t)+" found."};function Ss(r,t){t=t!==void 0?t:{};var e={},s=t.grammarSource,i={pgn:rt},o=rt,f="[",c='"',p="]",d=".",m="O-O-O",y="O-O",g="0-0-0",v="0-0",E="$",$="{",q="}",he=";",B="(",Y=")",pe="1-0",Se="0-1",ue="1/2-1/2",Ke="*",H=/^[a-zA-Z]/,ge=/^[^"]/,ee=/^[0-9]/,ke=/^[.]/,Ne=/^[a-zA-Z1-8\-=]/,te=/^[+#]/,Ee=/^[!?]/,z=/^[^}]/,Ce=/^[^\r\n]/,me=/^[ \t\r\n]/,Ae=G("tag pair"),je=O("[",!1),_e=O('"',!1),qe=O("]",!1),Fe=G("tag name"),C=W([["a","z"],["A","Z"]],!1,!1),A=G("tag value"),P=W(['"'],!0,!1),T=G("move number"),I=W([["0","9"]],!1,!1),V=O(".",!1),se=W(["."],!1,!1),ie=G("standard algebraic notation"),re=O("O-O-O",!1),ne=O("O-O",!1),oe=O("0-0-0",!1),xt=O("0-0",!1),Ze=W([["a","z"],["A","Z"],["1","8"],"-","="],!1,!1),yt=W(["+","#"],!1,!1),wt=G("suffix annotation"),Je=W(["!","?"],!1,!1),St=G("NAG"),kt=O("$",!1),Nt=G("brace comment"),Et=O("{",!1),Xe=W(["}"],!0,!1),Ct=O("}",!1),At=G("rest of line comment"),jt=O(";",!1),et=W(["\r",`
`],!0,!1),$t=G("variation"),Pt=O("(",!1),It=O(")",!1),Tt=G("game termination marker"),Mt=O("1-0",!1),Rt=O("0-1",!1),Ot=O("1/2-1/2",!1),Lt=O("*",!1),Kt=G("whitespace"),tt=W([" ","	","\r",`
`],!1,!1),qt=function(n,h){return ys(n,h)},Ft=function(n){return Object.fromEntries(n)},Dt=function(n,h){return[n,h]},Ut=function(n,h){return{root:n,marker:h}},Gt=function(n,h){return xs(vs(n),...h.flat())},Bt=function(n,h,u,x,w){return bs(n,h,u,x,w)},Vt=function(n){return n},Qt=function(n){return n.replace(/[\r\n]+/g," ")},Wt=function(n){return n.trim()},Ht=function(n){return n},Yt=function(n,h){return{result:n,comment:h}},l=t.peg$currPos|0,fe=[{line:1,column:1}],Q=l,$e=t.peg$maxFailExpected||[],_=t.peg$silentFails|0,ve;if(t.startRule){if(!(t.startRule in i))throw new Error(`Can't start parsing from rule "`+t.startRule+'".');o=i[t.startRule]}function O(n,h){return{type:"literal",text:n,ignoreCase:h}}function W(n,h,u){return{type:"class",parts:n,inverted:h,ignoreCase:u}}function zt(){return{type:"end"}}function G(n){return{type:"other",description:n}}function st(n){var h=fe[n],u;if(h)return h;if(n>=fe.length)u=fe.length-1;else for(u=n;!fe[--u];);for(h=fe[u],h={line:h.line,column:h.column};u<n;)r.charCodeAt(u)===10?(h.line++,h.column=1):h.column++,u++;return fe[n]=h,h}function it(n,h,u){var x=st(n),w=st(h),j={source:s,start:{offset:n,line:x.line,column:x.column},end:{offset:h,line:w.line,column:w.column}};return j}function b(n){l<Q||(l>Q&&(Q=l,$e=[]),$e.push(n))}function Zt(n,h,u){return new de(de.buildMessage(n,h),n,h,u)}function rt(){var n,h,u;return n=l,h=Jt(),u=ts(),n=qt(h,u),n}function Jt(){var n,h,u;for(n=l,h=[],u=nt();u!==e;)h.push(u),u=nt();return u=D(),n=Ft(h),n}function nt(){var n,h,u,x,w,j,ae;return _++,n=l,D(),r.charCodeAt(l)===91?(h=f,l++):(h=e,_===0&&b(je)),h!==e?(D(),u=Xt(),u!==e?(D(),r.charCodeAt(l)===34?(x=c,l++):(x=e,_===0&&b(_e)),x!==e?(w=es(),r.charCodeAt(l)===34?(j=c,l++):(j=e,_===0&&b(_e)),j!==e?(D(),r.charCodeAt(l)===93?(ae=p,l++):(ae=e,_===0&&b(qe)),ae!==e?n=Dt(u,w):(l=n,n=e)):(l=n,n=e)):(l=n,n=e)):(l=n,n=e)):(l=n,n=e),_--,n===e&&_===0&&b(Ae),n}function Xt(){var n,h,u;if(_++,n=l,h=[],u=r.charAt(l),H.test(u)?l++:(u=e,_===0&&b(C)),u!==e)for(;u!==e;)h.push(u),u=r.charAt(l),H.test(u)?l++:(u=e,_===0&&b(C));else h=e;return h!==e?n=r.substring(n,l):n=h,_--,n===e&&(h=e,_===0&&b(Fe)),n}function es(){var n,h,u;for(_++,n=l,h=[],u=r.charAt(l),ge.test(u)?l++:(u=e,_===0&&b(P));u!==e;)h.push(u),u=r.charAt(l),ge.test(u)?l++:(u=e,_===0&&b(P));return n=r.substring(n,l),_--,h=e,_===0&&b(A),n}function ts(){var n,h,u;return n=l,h=ot(),D(),u=as(),u===e&&(u=null),D(),n=Ut(h,u),n}function ot(){var n,h,u,x;for(n=l,h=De(),h===e&&(h=null),u=[],x=at();x!==e;)u.push(x),x=at();return n=Gt(h,u),n}function at(){var n,h,u,x,w,j,ae,Pe;if(n=l,D(),ss(),D(),h=is(),h!==e){for(u=rs(),u===e&&(u=null),x=[],w=lt();w!==e;)x.push(w),w=lt();for(w=D(),j=De(),j===e&&(j=null),ae=[],Pe=ct();Pe!==e;)ae.push(Pe),Pe=ct();n=Bt(h,u,x,j,ae)}else l=n,n=e;return n}function ss(){var n,h,u,x,w,j;for(_++,n=l,h=[],u=r.charAt(l),ee.test(u)?l++:(u=e,_===0&&b(I));u!==e;)h.push(u),u=r.charAt(l),ee.test(u)?l++:(u=e,_===0&&b(I));if(r.charCodeAt(l)===46?(u=d,l++):(u=e,_===0&&b(V)),u!==e){for(x=D(),w=[],j=r.charAt(l),ke.test(j)?l++:(j=e,_===0&&b(se));j!==e;)w.push(j),j=r.charAt(l),ke.test(j)?l++:(j=e,_===0&&b(se));h=[h,u,x,w],n=h}else l=n,n=e;return _--,n===e&&(h=e,_===0&&b(T)),n}function is(){var n,h,u,x,w,j;if(_++,n=l,h=l,r.substr(l,5)===m?(u=m,l+=5):(u=e,_===0&&b(re)),u===e&&(r.substr(l,3)===y?(u=y,l+=3):(u=e,_===0&&b(ne)),u===e&&(r.substr(l,5)===g?(u=g,l+=5):(u=e,_===0&&b(oe)),u===e&&(r.substr(l,3)===v?(u=v,l+=3):(u=e,_===0&&b(xt)),u===e))))if(u=l,x=r.charAt(l),H.test(x)?l++:(x=e,_===0&&b(C)),x!==e){if(w=[],j=r.charAt(l),Ne.test(j)?l++:(j=e,_===0&&b(Ze)),j!==e)for(;j!==e;)w.push(j),j=r.charAt(l),Ne.test(j)?l++:(j=e,_===0&&b(Ze));else w=e;w!==e?(x=[x,w],u=x):(l=u,u=e)}else l=u,u=e;return u!==e?(x=r.charAt(l),te.test(x)?l++:(x=e,_===0&&b(yt)),x===e&&(x=null),u=[u,x],h=u):(l=h,h=e),h!==e?n=r.substring(n,l):n=h,_--,n===e&&(h=e,_===0&&b(ie)),n}function rs(){var n,h,u;for(_++,n=l,h=[],u=r.charAt(l),Ee.test(u)?l++:(u=e,_===0&&b(Je));u!==e;)h.push(u),h.length>=2?u=e:(u=r.charAt(l),Ee.test(u)?l++:(u=e,_===0&&b(Je)));return h.length<1?(l=n,n=e):n=h,_--,n===e&&(h=e,_===0&&b(wt)),n}function lt(){var n,h,u,x,w;if(_++,n=l,D(),r.charCodeAt(l)===36?(h=E,l++):(h=e,_===0&&b(kt)),h!==e){if(u=l,x=[],w=r.charAt(l),ee.test(w)?l++:(w=e,_===0&&b(I)),w!==e)for(;w!==e;)x.push(w),w=r.charAt(l),ee.test(w)?l++:(w=e,_===0&&b(I));else x=e;x!==e?u=r.substring(u,l):u=x,u!==e?n=Vt(u):(l=n,n=e)}else l=n,n=e;return _--,n===e&&_===0&&b(St),n}function De(){var n;return n=ns(),n===e&&(n=os()),n}function ns(){var n,h,u,x,w;if(_++,n=l,r.charCodeAt(l)===123?(h=$,l++):(h=e,_===0&&b(Et)),h!==e){for(u=l,x=[],w=r.charAt(l),z.test(w)?l++:(w=e,_===0&&b(Xe));w!==e;)x.push(w),w=r.charAt(l),z.test(w)?l++:(w=e,_===0&&b(Xe));u=r.substring(u,l),r.charCodeAt(l)===125?(x=q,l++):(x=e,_===0&&b(Ct)),x!==e?n=Qt(u):(l=n,n=e)}else l=n,n=e;return _--,n===e&&(h=e,_===0&&b(Nt)),n}function os(){var n,h,u,x,w;if(_++,n=l,r.charCodeAt(l)===59?(h=he,l++):(h=e,_===0&&b(jt)),h!==e){for(u=l,x=[],w=r.charAt(l),Ce.test(w)?l++:(w=e,_===0&&b(et));w!==e;)x.push(w),w=r.charAt(l),Ce.test(w)?l++:(w=e,_===0&&b(et));u=r.substring(u,l),n=Wt(u)}else l=n,n=e;return _--,n===e&&(h=e,_===0&&b(At)),n}function ct(){var n,h,u,x;return _++,n=l,D(),r.charCodeAt(l)===40?(h=B,l++):(h=e,_===0&&b(Pt)),h!==e?(u=ot(),u!==e?(D(),r.charCodeAt(l)===41?(x=Y,l++):(x=e,_===0&&b(It)),x!==e?n=Ht(u):(l=n,n=e)):(l=n,n=e)):(l=n,n=e),_--,n===e&&_===0&&b($t),n}function as(){var n,h,u;return _++,n=l,r.substr(l,3)===pe?(h=pe,l+=3):(h=e,_===0&&b(Mt)),h===e&&(r.substr(l,3)===Se?(h=Se,l+=3):(h=e,_===0&&b(Rt)),h===e&&(r.substr(l,7)===ue?(h=ue,l+=7):(h=e,_===0&&b(Ot)),h===e&&(r.charCodeAt(l)===42?(h=Ke,l++):(h=e,_===0&&b(Lt))))),h!==e?(D(),u=De(),u===e&&(u=null),n=Yt(h,u)):(l=n,n=e),_--,n===e&&(h=e,_===0&&b(Tt)),n}function D(){var n,h;for(_++,n=[],h=r.charAt(l),me.test(h)?l++:(h=e,_===0&&b(tt));h!==e;)n.push(h),h=r.charAt(l),me.test(h)?l++:(h=e,_===0&&b(tt));return _--,h=e,_===0&&b(Kt),n}if(ve=o(),t.peg$library)return{peg$result:ve,peg$currPos:l,peg$FAILED:e,peg$maxFailExpected:$e,peg$maxFailPos:Q};if(ve!==e&&l===r.length)return ve;throw ve!==e&&l<r.length&&b(zt()),Zt($e,Q<r.length?r.charAt(Q):null,Q<r.length?it(Q,Q+1):it(Q,Q))}const Re=0xffffffffffffffffn;function Ge(r,t){return(r<<t|r>>64n-t)&0xffffffffffffffffn}function ht(r,t){return r*t&Re}function ks(r){return function(){let t=BigInt(r&Re),e=BigInt(r>>64n&Re);const s=ht(Ge(ht(t,5n),7n),9n);return e^=t,t=(Ge(t,24n)^e^e<<16n)&Re,e=Ge(e,37n),r=e<<64n|t,s}}const Le=ks(0xa187eb39cdcaed8f31c4b365b102e01en),Ns=Array.from({length:2},()=>Array.from({length:6},()=>Array.from({length:128},()=>Le()))),Es=Array.from({length:8},()=>Le()),Cs=Array.from({length:16},()=>Le()),Be=Le(),F="w",U="b",M="p",Ye="n",Oe="b",ye="r",X="q",R="k",Ve="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class Ie{color;from;to;piece;captured;promotion;flags;san;lan;before;after;constructor(t,e){const{color:s,piece:i,from:o,to:f,flags:c,captured:p,promotion:d}=e,m=L(o),y=L(f);this.color=s,this.piece=i,this.from=m,this.to=y,this.san=t._moveToSan(e,t._moves({legal:!0})),this.lan=m+y,this.before=t.fen(),t._makeMove(e),this.after=t.fen(),t._undoMove(),this.flags="";for(const g in k)k[g]&c&&(this.flags+=le[g]);p&&(this.captured=p),d&&(this.promotion=d,this.lan+=d)}isCapture(){return this.flags.indexOf(le.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(le.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(le.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(le.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(le.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(le.BIG_PAWN)>-1}}const K=-1,le={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q",NULL_MOVE:"-"},k={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64,NULL_MOVE:128},ze={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},As={WhiteTitle:null,BlackTitle:null,WhiteElo:null,BlackElo:null,WhiteUSCF:null,BlackUSCF:null,WhiteNA:null,BlackNA:null,WhiteType:null,BlackType:null,EventDate:null,EventSponsor:null,Section:null,Stage:null,Board:null,Opening:null,Variation:null,SubVariation:null,ECO:null,NIC:null,Time:null,UTCTime:null,UTCDate:null,TimeControl:null,SetUp:null,FEN:null,Termination:null,Annotator:null,Mode:null,PlyCount:null},js={...ze,...As},S={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},Qe={b:[16,32,17,15],w:[-16,-32,-17,-15]},ut={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},$s=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],Ps=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],Is={p:1,n:2,b:4,r:8,q:16,k:32},Ts="pnbrqkPNBRQK",ft=[Ye,Oe,ye,X],Ms=7,Rs=6,Os=1,Ls=0,Te={[R]:k.KSIDE_CASTLE,[X]:k.QSIDE_CASTLE},Z={w:[{square:S.a1,flag:k.QSIDE_CASTLE},{square:S.h1,flag:k.KSIDE_CASTLE}],b:[{square:S.a8,flag:k.QSIDE_CASTLE},{square:S.h8,flag:k.KSIDE_CASTLE}]},Ks={b:Os,w:Rs},We="--";function ce(r){return r>>4}function we(r){return r&15}function bt(r){return"0123456789".indexOf(r)!==-1}function L(r){const t=we(r),e=ce(r);return"abcdefgh".substring(t,t+1)+"87654321".substring(e,e+1)}function xe(r){return r===F?U:F}function qs(r){const t=r.split(/\s+/);if(t.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const e=parseInt(t[5],10);if(isNaN(e)||e<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const s=parseInt(t[4],10);if(isNaN(s)||s<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(t[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(t[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(t[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const i=t[0].split("/");if(i.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let f=0;f<i.length;f++){let c=0,p=!1;for(let d=0;d<i[f].length;d++)if(bt(i[f][d])){if(p)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};c+=parseInt(i[f][d],10),p=!0}else{if(!/^[prnbqkPRNBQK]$/.test(i[f][d]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};c+=1,p=!1}if(c!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(t[3][1]=="3"&&t[1]=="w"||t[3][1]=="6"&&t[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const o=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:f,regex:c}of o){if(!c.test(t[0]))return{ok:!1,error:`Invalid FEN: missing ${f} king`};if((t[0].match(c)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${f} kings`}}return Array.from(i[0]+i[7]).some(f=>f.toUpperCase()==="P")?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}function Fs(r,t){const e=r.from,s=r.to,i=r.piece;let o=0,f=0,c=0;for(let p=0,d=t.length;p<d;p++){const m=t[p].from,y=t[p].to,g=t[p].piece;i===g&&e!==m&&s===y&&(o++,ce(e)===ce(m)&&f++,we(e)===we(m)&&c++)}return o>0?f>0&&c>0?L(e):c>0?L(e).charAt(1):L(e).charAt(0):""}function J(r,t,e,s,i,o=void 0,f=k.NORMAL){const c=ce(s);if(i===M&&(c===Ms||c===Ls))for(let p=0;p<ft.length;p++){const d=ft[p];r.push({color:t,from:e,to:s,piece:i,captured:o,promotion:d,flags:f|k.PROMOTION})}else r.push({color:t,from:e,to:s,piece:i,captured:o,flags:f})}function dt(r){let t=r.charAt(0);return t>="a"&&t<="h"?r.match(/[a-h]\d.*[a-h]\d/)?void 0:M:(t=t.toLowerCase(),t==="o"?R:t)}function He(r){return r.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}class Ds{_board=new Array(128);_turn=F;_header={};_kings={w:K,b:K};_epSquare=-1;_halfMoves=0;_moveNumber=0;_history=[];_comments={};_castling={w:0,b:0};_hash=0n;_positionCount=new Map;constructor(t=Ve,{skipValidation:e=!1}={}){this.load(t,{skipValidation:e})}clear({preserveHeaders:t=!1}={}){this._board=new Array(128),this._kings={w:K,b:K},this._turn=F,this._castling={w:0,b:0},this._epSquare=K,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=t?this._header:{...js},this._hash=this._computeHash(),this._positionCount=new Map,this._header.SetUp=null,this._header.FEN=null}load(t,{skipValidation:e=!1,preserveHeaders:s=!1}={}){let i=t.split(/\s+/);if(i.length>=2&&i.length<6){const c=["-","-","0","1"];t=i.concat(c.slice(-(6-i.length))).join(" ")}if(i=t.split(/\s+/),!e){const{ok:c,error:p}=qs(t);if(!c)throw new Error(p)}const o=i[0];let f=0;this.clear({preserveHeaders:s});for(let c=0;c<o.length;c++){const p=o.charAt(c);if(p==="/")f+=8;else if(bt(p))f+=parseInt(p,10);else{const d=p<"a"?F:U;this._put({type:p.toLowerCase(),color:d},L(f)),f++}}this._turn=i[1],i[2].indexOf("K")>-1&&(this._castling.w|=k.KSIDE_CASTLE),i[2].indexOf("Q")>-1&&(this._castling.w|=k.QSIDE_CASTLE),i[2].indexOf("k")>-1&&(this._castling.b|=k.KSIDE_CASTLE),i[2].indexOf("q")>-1&&(this._castling.b|=k.QSIDE_CASTLE),this._epSquare=i[3]==="-"?K:S[i[3]],this._halfMoves=parseInt(i[4],10),this._moveNumber=parseInt(i[5],10),this._hash=this._computeHash(),this._updateSetup(t),this._incPositionCount()}fen({forceEnpassantSquare:t=!1}={}){let e=0,s="";for(let f=S.a8;f<=S.h1;f++){if(this._board[f]){e>0&&(s+=e,e=0);const{color:c,type:p}=this._board[f];s+=c===F?p.toUpperCase():p.toLowerCase()}else e++;f+1&136&&(e>0&&(s+=e),f!==S.h1&&(s+="/"),e=0,f+=8)}let i="";this._castling[F]&k.KSIDE_CASTLE&&(i+="K"),this._castling[F]&k.QSIDE_CASTLE&&(i+="Q"),this._castling[U]&k.KSIDE_CASTLE&&(i+="k"),this._castling[U]&k.QSIDE_CASTLE&&(i+="q"),i=i||"-";let o="-";if(this._epSquare!==K)if(t)o=L(this._epSquare);else{const f=this._epSquare+(this._turn===F?16:-16),c=[f+1,f-1];for(const p of c){if(p&136)continue;const d=this._turn;if(this._board[p]?.color===d&&this._board[p]?.type===M){this._makeMove({color:d,from:p,to:this._epSquare,piece:M,captured:M,flags:k.EP_CAPTURE});const m=!this._isKingAttacked(d);if(this._undoMove(),m){o=L(this._epSquare);break}}}}return[s,this._turn,i,o,this._halfMoves,this._moveNumber].join(" ")}_pieceKey(t){if(!this._board[t])return 0n;const{color:e,type:s}=this._board[t],i={w:0,b:1}[e],o={p:0,n:1,b:2,r:3,q:4,k:5}[s];return Ns[i][o][t]}_epKey(){return this._epSquare===K?0n:Es[this._epSquare&7]}_castlingKey(){const t=this._castling.w>>5|this._castling.b>>3;return Cs[t]}_computeHash(){let t=0n;for(let e=S.a8;e<=S.h1;e++){if(e&136){e+=7;continue}this._board[e]&&(t^=this._pieceKey(e))}return t^=this._epKey(),t^=this._castlingKey(),this._turn==="b"&&(t^=Be),t}_updateSetup(t){this._history.length>0||(t!==Ve?(this._header.SetUp="1",this._header.FEN=t):(this._header.SetUp=null,this._header.FEN=null))}reset(){this.load(Ve)}get(t){return this._board[S[t]]}findPiece(t){const e=[];for(let s=S.a8;s<=S.h1;s++){if(s&136){s+=7;continue}!this._board[s]||this._board[s]?.color!==t.color||this._board[s].color===t.color&&this._board[s].type===t.type&&e.push(L(s))}return e}put({type:t,color:e},s){return this._put({type:t,color:e},s)?(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0):!1}_set(t,e){this._hash^=this._pieceKey(t),this._board[t]=e,this._hash^=this._pieceKey(t)}_put({type:t,color:e},s){if(Ts.indexOf(t.toLowerCase())===-1||!(s in S))return!1;const i=S[s];if(t==R&&!(this._kings[e]==K||this._kings[e]==i))return!1;const o=this._board[i];return o&&o.type===R&&(this._kings[o.color]=K),this._set(i,{type:t,color:e}),t===R&&(this._kings[e]=i),!0}_clear(t){this._hash^=this._pieceKey(t),delete this._board[t]}remove(t){const e=this.get(t);return this._clear(S[t]),e&&e.type===R&&(this._kings[e.color]=K),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),e}_updateCastlingRights(){this._hash^=this._castlingKey();const t=this._board[S.e1]?.type===R&&this._board[S.e1]?.color===F,e=this._board[S.e8]?.type===R&&this._board[S.e8]?.color===U;(!t||this._board[S.a1]?.type!==ye||this._board[S.a1]?.color!==F)&&(this._castling.w&=-65),(!t||this._board[S.h1]?.type!==ye||this._board[S.h1]?.color!==F)&&(this._castling.w&=-33),(!e||this._board[S.a8]?.type!==ye||this._board[S.a8]?.color!==U)&&(this._castling.b&=-65),(!e||this._board[S.h8]?.type!==ye||this._board[S.h8]?.color!==U)&&(this._castling.b&=-33),this._hash^=this._castlingKey()}_updateEnPassantSquare(){if(this._epSquare===K)return;const t=this._epSquare+(this._turn===F?-16:16),e=this._epSquare+(this._turn===F?16:-16),s=[e+1,e-1];if(this._board[t]!==null||this._board[this._epSquare]!==null||this._board[e]?.color!==xe(this._turn)||this._board[e]?.type!==M){this._hash^=this._epKey(),this._epSquare=K;return}const i=o=>!(o&136)&&this._board[o]?.color===this._turn&&this._board[o]?.type===M;s.some(i)||(this._hash^=this._epKey(),this._epSquare=K)}_attacked(t,e,s){const i=[];for(let o=S.a8;o<=S.h1;o++){if(o&136){o+=7;continue}if(this._board[o]===void 0||this._board[o].color!==t)continue;const f=this._board[o],c=o-e;if(c===0)continue;const p=c+119;if($s[p]&Is[f.type]){if(f.type===M){if(c>0&&f.color===F||c<=0&&f.color===U)if(s)i.push(L(o));else return!0;continue}if(f.type==="n"||f.type==="k")if(s){i.push(L(o));continue}else return!0;const d=Ps[p];let m=o+d,y=!1;for(;m!==e;){if(this._board[m]!=null){y=!0;break}m+=d}if(!y)if(s){i.push(L(o));continue}else return!0}}return s?i:!1}attackers(t,e){return e?this._attacked(e,S[t],!0):this._attacked(this._turn,S[t],!0)}_isKingAttacked(t){const e=this._kings[t];return e===-1?!1:this._attacked(xe(t),e)}hash(){return this._hash.toString(16)}isAttacked(t,e){return this._attacked(e,S[t])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const t={b:0,n:0,r:0,q:0,k:0,p:0},e=[];let s=0,i=0;for(let o=S.a8;o<=S.h1;o++){if(i=(i+1)%2,o&136){o+=7;continue}const f=this._board[o];f&&(t[f.type]=f.type in t?t[f.type]+1:1,f.type===Oe&&e.push(i),s++)}if(s===2)return!0;if(s===3&&(t[Oe]===1||t[Ye]===1))return!0;if(s===t[Oe]+2){let o=0;const f=e.length;for(let c=0;c<f;c++)o+=e[c];if(o===0||o===f)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this._hash)>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isDraw()}moves({verbose:t=!1,square:e=void 0,piece:s=void 0}={}){const i=this._moves({square:e,piece:s});return t?i.map(o=>new Ie(this,o)):i.map(o=>this._moveToSan(o,i))}_moves({legal:t=!0,piece:e=void 0,square:s=void 0}={}){const i=s?s.toLowerCase():void 0,o=e?.toLowerCase(),f=[],c=this._turn,p=xe(c);let d=S.a8,m=S.h1,y=!1;if(i)if(i in S)d=m=S[i],y=!0;else return[];for(let v=d;v<=m;v++){if(v&136){v+=7;continue}if(!this._board[v]||this._board[v].color===p)continue;const{type:E}=this._board[v];let $;if(E===M){if(o&&o!==E)continue;$=v+Qe[c][0],this._board[$]||(J(f,c,v,$,M),$=v+Qe[c][1],Ks[c]===ce(v)&&!this._board[$]&&J(f,c,v,$,M,void 0,k.BIG_PAWN));for(let q=2;q<4;q++)$=v+Qe[c][q],!($&136)&&(this._board[$]?.color===p?J(f,c,v,$,M,this._board[$].type,k.CAPTURE):$===this._epSquare&&J(f,c,v,$,M,M,k.EP_CAPTURE))}else{if(o&&o!==E)continue;for(let q=0,he=ut[E].length;q<he;q++){const B=ut[E][q];for($=v;$+=B,!($&136);){if(!this._board[$])J(f,c,v,$,E);else{if(this._board[$].color===c)break;J(f,c,v,$,E,this._board[$].type,k.CAPTURE);break}if(E===Ye||E===R)break}}}}if((o===void 0||o===R)&&(!y||m===this._kings[c])){if(this._castling[c]&k.KSIDE_CASTLE){const v=this._kings[c],E=v+2;!this._board[v+1]&&!this._board[E]&&!this._attacked(p,this._kings[c])&&!this._attacked(p,v+1)&&!this._attacked(p,E)&&J(f,c,this._kings[c],E,R,void 0,k.KSIDE_CASTLE)}if(this._castling[c]&k.QSIDE_CASTLE){const v=this._kings[c],E=v-2;!this._board[v-1]&&!this._board[v-2]&&!this._board[v-3]&&!this._attacked(p,this._kings[c])&&!this._attacked(p,v-1)&&!this._attacked(p,E)&&J(f,c,this._kings[c],E,R,void 0,k.QSIDE_CASTLE)}}if(!t||this._kings[c]===-1)return f;const g=[];for(let v=0,E=f.length;v<E;v++)this._makeMove(f[v]),this._isKingAttacked(c)||g.push(f[v]),this._undoMove();return g}move(t,{strict:e=!1}={}){let s=null;if(typeof t=="string")s=this._moveFromSan(t,e);else if(t===null)s=this._moveFromSan(We,e);else if(typeof t=="object"){const o=this._moves();for(let f=0,c=o.length;f<c;f++)if(t.from===L(o[f].from)&&t.to===L(o[f].to)&&(!("promotion"in o[f])||t.promotion===o[f].promotion)){s=o[f];break}}if(!s)throw typeof t=="string"?new Error(`Invalid move: ${t}`):new Error(`Invalid move: ${JSON.stringify(t)}`);if(this.isCheck()&&s.flags&k.NULL_MOVE)throw new Error("Null move not allowed when in check");const i=new Ie(this,s);return this._makeMove(s),this._incPositionCount(),i}_push(t){this._history.push({move:t,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_movePiece(t,e){this._hash^=this._pieceKey(t),this._board[e]=this._board[t],delete this._board[t],this._hash^=this._pieceKey(e)}_makeMove(t){const e=this._turn,s=xe(e);if(this._push(t),t.flags&k.NULL_MOVE){e===U&&this._moveNumber++,this._halfMoves++,this._turn=s,this._epSquare=K;return}if(this._hash^=this._epKey(),this._hash^=this._castlingKey(),t.captured&&(this._hash^=this._pieceKey(t.to)),this._movePiece(t.from,t.to),t.flags&k.EP_CAPTURE&&(this._turn===U?this._clear(t.to-16):this._clear(t.to+16)),t.promotion&&(this._clear(t.to),this._set(t.to,{type:t.promotion,color:e})),this._board[t.to].type===R){if(this._kings[e]=t.to,t.flags&k.KSIDE_CASTLE){const i=t.to-1,o=t.to+1;this._movePiece(o,i)}else if(t.flags&k.QSIDE_CASTLE){const i=t.to+1,o=t.to-2;this._movePiece(o,i)}this._castling[e]=0}if(this._castling[e]){for(let i=0,o=Z[e].length;i<o;i++)if(t.from===Z[e][i].square&&this._castling[e]&Z[e][i].flag){this._castling[e]^=Z[e][i].flag;break}}if(this._castling[s]){for(let i=0,o=Z[s].length;i<o;i++)if(t.to===Z[s][i].square&&this._castling[s]&Z[s][i].flag){this._castling[s]^=Z[s][i].flag;break}}if(this._hash^=this._castlingKey(),t.flags&k.BIG_PAWN){let i;e===U?i=t.to-16:i=t.to+16,!(t.to-1&136)&&this._board[t.to-1]?.type===M&&this._board[t.to-1]?.color===s||!(t.to+1&136)&&this._board[t.to+1]?.type===M&&this._board[t.to+1]?.color===s?(this._epSquare=i,this._hash^=this._epKey()):this._epSquare=K}else this._epSquare=K;t.piece===M?this._halfMoves=0:t.flags&(k.CAPTURE|k.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,e===U&&this._moveNumber++,this._turn=s,this._hash^=Be}undo(){const t=this._hash,e=this._undoMove();if(e){const s=new Ie(this,e);return this._decPositionCount(t),s}return null}_undoMove(){const t=this._history.pop();if(t===void 0)return null;this._hash^=this._epKey(),this._hash^=this._castlingKey();const e=t.move;this._kings=t.kings,this._turn=t.turn,this._castling=t.castling,this._epSquare=t.epSquare,this._halfMoves=t.halfMoves,this._moveNumber=t.moveNumber,this._hash^=this._epKey(),this._hash^=this._castlingKey(),this._hash^=Be;const s=this._turn,i=xe(s);if(e.flags&k.NULL_MOVE)return e;if(this._movePiece(e.to,e.from),e.piece&&(this._clear(e.from),this._set(e.from,{type:e.piece,color:s})),e.captured)if(e.flags&k.EP_CAPTURE){let o;s===U?o=e.to-16:o=e.to+16,this._set(o,{type:M,color:i})}else this._set(e.to,{type:e.captured,color:i});if(e.flags&(k.KSIDE_CASTLE|k.QSIDE_CASTLE)){let o,f;e.flags&k.KSIDE_CASTLE?(o=e.to+1,f=e.to-1):(o=e.to-2,f=e.to+1),this._movePiece(f,o)}return e}pgn({newline:t=`
`,maxWidth:e=0}={}){const s=[];let i=!1;for(const g in this._header)this._header[g]&&s.push(`[${g} "${this._header[g]}"]`+t),i=!0;i&&this._history.length&&s.push(t);const o=g=>{const v=this._comments[this.fen()];if(typeof v<"u"){const E=g.length>0?" ":"";g=`${g}${E}{${v}}`}return g},f=[];for(;this._history.length>0;)f.push(this._undoMove());const c=[];let p="";for(f.length===0&&c.push(o(""));f.length>0;){p=o(p);const g=f.pop();if(!g)break;if(!this._history.length&&g.color==="b"){const v=`${this._moveNumber}. ...`;p=p?`${p} ${v}`:v}else g.color==="w"&&(p.length&&c.push(p),p=this._moveNumber+".");p=p+" "+this._moveToSan(g,this._moves({legal:!0})),this._makeMove(g)}if(p.length&&c.push(o(p)),c.push(this._header.Result||"*"),e===0)return s.join("")+c.join(" ");const d=function(){return s.length>0&&s[s.length-1]===" "?(s.pop(),!0):!1},m=function(g,v){for(const E of v.split(" "))if(E){if(g+E.length>e){for(;d();)g--;s.push(t),g=0}s.push(E),g+=E.length,s.push(" "),g++}return d()&&g--,g};let y=0;for(let g=0;g<c.length;g++){if(y+c[g].length>e&&c[g].includes("{")){y=m(y,c[g]);continue}y+c[g].length>e&&g!==0?(s[s.length-1]===" "&&s.pop(),s.push(t),y=0):g!==0&&(s.push(" "),y++),s.push(c[g]),y+=c[g].length}return s.join("")}header(...t){for(let e=0;e<t.length;e+=2)typeof t[e]=="string"&&typeof t[e+1]=="string"&&(this._header[t[e]]=t[e+1]);return this._header}setHeader(t,e){return this._header[t]=e??ze[t]??null,this.getHeaders()}removeHeader(t){return t in this._header?(this._header[t]=ze[t]||null,!0):!1}getHeaders(){const t={};for(const[e,s]of Object.entries(this._header))s!==null&&(t[e]=s);return t}loadPgn(t,{strict:e=!1,newlineChar:s=`\r?
`}={}){s!==`\r?
`&&(t=t.replace(new RegExp(s,"g"),`
`));const i=Ss(t);this.reset();const o=i.headers;let f="";for(const d in o)d.toLowerCase()==="fen"&&(f=o[d]),this.header(d,o[d]);if(!e)f&&this.load(f,{preserveHeaders:!0});else if(o.SetUp==="1"){if(!("FEN"in o))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(o.FEN,{preserveHeaders:!0})}let c=i.root;for(;c;){if(c.move){const d=this._moveFromSan(c.move,e);if(d==null)throw new Error(`Invalid move in PGN: ${c.move}`);this._makeMove(d),this._incPositionCount()}c.comment!==void 0&&(this._comments[this.fen()]=c.comment),c=c.variations[0]}const p=i.result;p&&Object.keys(this._header).length&&this._header.Result!==p&&this.setHeader("Result",p)}_moveToSan(t,e){let s="";if(t.flags&k.KSIDE_CASTLE)s="O-O";else if(t.flags&k.QSIDE_CASTLE)s="O-O-O";else{if(t.flags&k.NULL_MOVE)return We;if(t.piece!==M){const i=Fs(t,e);s+=t.piece.toUpperCase()+i}t.flags&(k.CAPTURE|k.EP_CAPTURE)&&(t.piece===M&&(s+=L(t.from)[0]),s+="x"),s+=L(t.to),t.promotion&&(s+="="+t.promotion.toUpperCase())}return this._makeMove(t),this.isCheck()&&(this.isCheckmate()?s+="#":s+="+"),this._undoMove(),s}_moveFromSan(t,e=!1){let s=He(t);if(e||(s==="0-0"?s="O-O":s==="0-0-0"&&(s="O-O-O")),s==We)return{color:this._turn,from:0,to:0,piece:"k",flags:k.NULL_MOVE};let i=dt(s),o=this._moves({legal:!0,piece:i});for(let g=0,v=o.length;g<v;g++)if(s===He(this._moveToSan(o[g],o)))return o[g];if(e)return null;let f,c,p,d,m,y=!1;if(c=s.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),c?(f=c[1],p=c[2],d=c[3],m=c[4],p.length==1&&(y=!0)):(c=s.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),c&&(f=c[1],p=c[2],d=c[3],m=c[4],p.length==1&&(y=!0))),i=dt(s),o=this._moves({legal:!0,piece:f||i}),!d)return null;for(let g=0,v=o.length;g<v;g++)if(p){if((!f||f.toLowerCase()==o[g].piece)&&S[p]==o[g].from&&S[d]==o[g].to&&(!m||m.toLowerCase()==o[g].promotion))return o[g];if(y){const E=L(o[g].from);if((!f||f.toLowerCase()==o[g].piece)&&S[d]==o[g].to&&(p==E[0]||p==E[1])&&(!m||m.toLowerCase()==o[g].promotion))return o[g]}}else if(s===He(this._moveToSan(o[g],o)).replace("x",""))return o[g];return null}ascii(){let t=`   +------------------------+
`;for(let e=S.a8;e<=S.h1;e++){if(we(e)===0&&(t+=" "+"87654321"[ce(e)]+" |"),this._board[e]){const s=this._board[e].type,o=this._board[e].color===F?s.toUpperCase():s.toLowerCase();t+=" "+o+" "}else t+=" . ";e+1&136&&(t+=`|
`,e+=8)}return t+=`   +------------------------+
`,t+="     a  b  c  d  e  f  g  h",t}perft(t){const e=this._moves({legal:!1});let s=0;const i=this._turn;for(let o=0,f=e.length;o<f;o++)this._makeMove(e[o]),this._isKingAttacked(i)||(t-1>0?s+=this.perft(t-1):s++),this._undoMove();return s}setTurn(t){return this._turn==t?!1:(this.move("--"),!0)}turn(){return this._turn}board(){const t=[];let e=[];for(let s=S.a8;s<=S.h1;s++)this._board[s]==null?e.push(null):e.push({square:L(s),type:this._board[s].type,color:this._board[s].color}),s+1&136&&(t.push(e),e=[],s+=8);return t}squareColor(t){if(t in S){const e=S[t];return(ce(e)+we(e))%2===0?"light":"dark"}return null}history({verbose:t=!1}={}){const e=[],s=[];for(;this._history.length>0;)e.push(this._undoMove());for(;;){const i=e.pop();if(!i)break;t?s.push(new Ie(this,i)):s.push(this._moveToSan(i,this._moves())),this._makeMove(i)}return s}_getPositionCount(t){return this._positionCount.get(t)??0}_incPositionCount(){this._positionCount.set(this._hash,(this._positionCount.get(this._hash)??0)+1)}_decPositionCount(t){const e=this._positionCount.get(t)??0;e===1?this._positionCount.delete(t):this._positionCount.set(t,e-1)}_pruneComments(){const t=[],e={},s=i=>{i in this._comments&&(e[i]=this._comments[i])};for(;this._history.length>0;)t.push(this._undoMove());for(s(this.fen());;){const i=t.pop();if(!i)break;this._makeMove(i),s(this.fen())}this._comments=e}getComment(){return this._comments[this.fen()]}setComment(t){this._comments[this.fen()]=t.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){const t=this._comments[this.fen()];return delete this._comments[this.fen()],t}getComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>({fen:t,comment:this._comments[t]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>{const e=this._comments[t];return delete this._comments[t],{fen:t,comment:e}})}setCastlingRights(t,e){for(const i of[R,X])e[i]!==void 0&&(e[i]?this._castling[t]|=Te[i]:this._castling[t]&=~Te[i]);this._updateCastlingRights();const s=this.getCastlingRights(t);return(e[R]===void 0||e[R]===s[R])&&(e[X]===void 0||e[X]===s[X])}getCastlingRights(t){return{[R]:(this._castling[t]&Te[R])!==0,[X]:(this._castling[t]&Te[X])!==0}}moveNumber(){return this._moveNumber}}class Us{constructor(){const t="/ATG-Test/",s=`${t.endsWith("/")?t:`${t}/`}stockfish/stockfish.js`;console.log("Initializing Stockfish Worker from:",s);try{this.worker=new Worker(s),this.worker.onerror=i=>{console.error("Stockfish Worker Error:",i.message,i)}}catch(i){console.error("Failed to create Stockfish Worker:",i),this.worker={postMessage:()=>{},onmessage:null,terminate:()=>{}}}this.isReady=!1,this.worker.onmessage=i=>{i.data==="uciok"&&(this.isReady=!0,console.log("Stockfish Engine Ready"))},this.worker.postMessage("uci")}onMessage(t){this.worker.onmessage=e=>{e.data==="uciok"&&(this.isReady=!0,console.log("Stockfish Engine Ready (from hook)")),t(e.data)}}evaluatePosition(t,e=800){console.log(`Sending to Stockfish: position fen ${t}`),console.log(`Sending to Stockfish: go movetime ${e}`),this.worker.postMessage("ucinewgame"),this.worker.postMessage(`position fen ${t}`),this.worker.postMessage(`go movetime ${e}`)}stop(){this.worker.postMessage("stop")}quit(){this.worker.postMessage("quit"),this.worker.terminate()}}function Gs({moves:r=[]}){const t=N.useRef(null);N.useEffect(()=>{t.current&&(t.current.scrollTop=t.current.scrollHeight)},[r]);const e=[],s=Array.isArray(r)?r:[];for(let i=0;i<s.length;i+=2)e.push({number:Math.floor(i/2)+1,white:s[i],black:s[i+1]||null});return a.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl overflow-hidden flex flex-col h-64 md:h-96",children:[a.jsx("div",{className:"bg-brand-navy/50 p-3 border-b border-white/10",children:a.jsx("h3",{className:"text-white font-display font-bold text-sm uppercase tracking-wider",children:"Move History"})}),a.jsxs("div",{ref:t,className:"flex-1 overflow-y-auto p-2 scrollbar-thin scrollbar-thumb-white/20 scrollbar-track-transparent",children:[a.jsxs("table",{className:"w-full text-sm text-slate-300",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"text-xs text-slate-500 uppercase text-left",children:[a.jsx("th",{className:"py-1 pl-2 w-10",children:"#"}),a.jsx("th",{className:"py-1",children:"White"}),a.jsx("th",{className:"py-1",children:"Black"})]})}),a.jsx("tbody",{children:e.map(i=>a.jsxs("tr",{className:"hover:bg-white/5 transition-colors border-b border-white/5 last:border-0",children:[a.jsxs("td",{className:"py-2 pl-2 font-mono text-slate-500",children:[i.number,"."]}),a.jsxs("td",{className:"py-2 font-medium text-white",children:[a.jsx("span",{className:"mr-2",children:i.white.san}),a.jsxs("span",{className:"text-xs text-slate-500",children:["(",i.white.from,"â†’",i.white.to,")"]})]}),a.jsx("td",{className:"py-2 font-medium text-slate-300",children:i.black?a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"mr-2",children:i.black.san}),a.jsxs("span",{className:"text-xs text-slate-500",children:["(",i.black.from,"â†’",i.black.to,")"]})]}):""})]},i.number))})]}),r.length===0&&a.jsx("div",{className:"h-full flex items-center justify-center text-slate-500 text-sm italic",children:"No moves yet. Start the game!"})]})]})}function Bs({onCommand:r}){const[t,e]=N.useState(!1),[s,i]=N.useState(""),[o,f]=N.useState(!1);N.useEffect(()=>{!("webkitSpeechRecognition"in window)&&!("SpeechRecognition"in window)&&f(!0)},[]);const c=()=>{if(o)return;if(t){e(!1);return}const p=window.SpeechRecognition||window.webkitSpeechRecognition,d=new p;d.lang="en-US",d.interimResults=!1,d.maxAlternatives=1,d.onstart=()=>{e(!0),i("Listening...")},d.onresult=m=>{const y=m.results.length-1,g=m.results[y][0].transcript;i(`Recognized: "${g}"`),r&&r(g)},d.onerror=m=>{i(`Error: ${m.error}`),e(!1)},d.onend=()=>{e(!1)},d.start()};return o?a.jsx("div",{className:"mt-4 text-xs text-red-400",children:"Voice control not supported in this browser."}):a.jsxs("div",{className:"mt-4 flex flex-col items-center gap-2",children:[a.jsxs("button",{onClick:c,className:`flex items-center gap-2 px-6 py-3 rounded-full transition-all shadow-lg ${t?"bg-red-500 hover:bg-red-600 text-white animate-pulse":"bg-brand-orange hover:bg-orange-600 text-white"}`,children:[a.jsx("span",{className:"material-symbols-outlined",children:t?"mic":"mic_none"}),a.jsx("span",{className:"font-medium",children:t?"Stop Listening":"Voice Command"})]}),s&&a.jsx("div",{className:"text-white/80 text-sm font-light italic",children:s})]})}const Me="ATG_CHESS_APP_SECRET_SALT_2026",pt={encrypt:r=>{if(!r)return"";let t="";for(let e=0;e<r.length;e++)t+=String.fromCharCode(r.charCodeAt(e)^Me.charCodeAt(e%Me.length));return btoa(t)},decrypt:r=>{if(!r)return"";try{const t=atob(r);let e="";for(let s=0;s<t.length;s++)e+=String.fromCharCode(t.charCodeAt(s)^Me.charCodeAt(s%Me.length));return e}catch(t){return console.error("Failed to decrypt key",t),""}}},gt={GEMINI_API_KEY_ENC:"Pz4zOj0+Pj4="},mt={getMoveFromNaturalLanguage:async(r,t)=>{try{const e=pt.decrypt(gt.GEMINI_API_KEY_ENC);if(!e||e==="DUMMY_KEY"||e.includes("Pz4zOj0+Pj4="))return console.warn("Gemini API Key is missing or invalid. Voice commands needing AI interpretation will fail safely."),null;const s=`
            You are a chess engine helper. 
            Current board FEN: ${t}
            User command: "${r}"
            
            Interpret the command and return the move in UCI format (e.g., "e2e4" or "g1f3" or "a7a8q" for promotion).
            If the command is ambiguous or invalid, return "INVALID".
            Only return the move string, nothing else.
            `,f=(await(await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:s}]}]})})).json()).candidates?.[0]?.content?.parts?.[0]?.text?.trim();return!f||f==="INVALID"?null:f.length>=4?{from:f.substring(0,2),to:f.substring(2,4),promotion:f.length>4?f[4]:"q"}:null}catch(e){return console.error("Error calling Gemini API:",e),null}},getMoveCommentary:async(r,t,e)=>{try{const s=pt.decrypt(gt.GEMINI_API_KEY_ENC);if(!s||s==="DUMMY_KEY"||s.includes("Pz4zOj0+Pj4="))return null;const i=["witty and slightly arrogant Grandmaster","nervous beginner pretending to be a pro","calm and philosophical teacher","aggressive and impatient player","sarcastic observer","overly dramatic anime villain"],f=`
            You are playing chess. Your personality for this move is: ${i[Math.floor(Math.random()*i.length)]}.
            Current FEN: ${r}
            User just played: ${t||"nothing (Start of game)"}
            You are about to play: ${e}
            
            IMPORTANT: Do not repeat yourself. Be unique.
            Give me a very short, human-like reaction (maximum 1 sentence). 
            Do NOT sound robotic. Sound like a real person sitting across the board.
            React to their move or hint at your plan, but keep it vague and natural.
            
            Examples of style:
            - "Ooh, bold. I didn't see that coming."
            - "Really? That's your best shot?"
            - "Interesting... let's see how you handle this."
            - "My knight is coming for you!"
            
            Keep it under 15 words.
            `,c=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${s}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:f}]}],generationConfig:{temperature:.9,topK:40,topP:.95,maxOutputTokens:60}})});if(!c.ok){const m=await c.text();throw new Error(`Gemini API Error ${c.status}: ${m}`)}return(await c.json()).candidates?.[0]?.content?.parts?.[0]?.text?.trim()||"Hmm, interesting position..."}catch(s){console.error("Gemini Commentary Error:",s);const i=["Hmm, interesting position...","Let me calculate the lines...","I see what you're planning.","Precise play, but is it enough?","The center control is crucial here.","My pieces are ready to strike!","You leave me no choice but to attack.","Prepare yourself!","I perceive a weakness in your defense.","Aggression is the best defense, they say.","Bold, but perhaps reckless?","I wouldn't have done that.","Are you sure about that one?","A classic mistake, but I'll let it slide.","You're making this too easy.","Wait, did I leave that unguarded?","Let me think about this one...","That was unexpected.","Hold on, I need a second.","Tricky, very tricky."];return i[Math.floor(Math.random()*i.length)]}}},Vs=()=>{const[r,t]=N.useState([]),[e,s]=N.useState(!1),i=window.speechSynthesis,o=N.useRef(!0);N.useEffect(()=>{const d=()=>{const m=i.getVoices();o.current&&(t(m),console.log(`ðŸŽ¤ Voices Loaded: ${m.length}`))};return i.onvoiceschanged!==void 0&&(i.onvoiceschanged=d),d(),()=>{o.current=!1,i.onvoiceschanged!==void 0&&(i.onvoiceschanged=null)}},[i]);const f=N.useCallback(d=>{if(!d)return;console.log(`ðŸ”Š Speaking: "${d}"`),i.paused&&(console.log("â–¶ï¸ Resuming paused synth"),i.resume()),i.speaking&&i.cancel();let m=r;m.length===0&&(m=i.getVoices(),console.log(`âš ï¸ Voices were empty, re-fetched: ${m.length}`));const y=new SpeechSynthesisUtterance(d);let g=r.find(v=>v.name==="Google UK English Male");g||(g=r.find(v=>v.name==="Daniel")),g||(g=r.find(v=>v.name.toLowerCase().includes("male")&&!v.name.toLowerCase().includes("female"))),g||(g=r.find(v=>v.name==="Alex")),g?(y.voice=g,console.log(`ðŸŽ¤ Voice Selected: ${g.name}`)):r.length>0&&(console.warn(`âš ï¸ No male voice found. Defaulting to: ${r[0].name}`),y.voice=r[0]),y.rate=.85,y.pitch=.9,y.onstart=()=>s(!0),y.onend=()=>s(!1),y.onerror=v=>{console.error("âŒ Speech Error:",v),s(!1)},i.speak(y)},[r,i]),c=N.useCallback(()=>{i.cancel(),s(!1)},[i]),p=N.useCallback(()=>{if(i.speaking)return;const d=new SpeechSynthesisUtterance("");d.volume=0,i.speak(d)},[i]);return{speak:f,cancel:c,wakeup:p,voices:r,isSpeaking:e}},Qs={w:{p:"https://upload.wikimedia.org/wikipedia/commons/4/45/Chess_plt45.svg",r:"https://upload.wikimedia.org/wikipedia/commons/7/72/Chess_rlt45.svg",n:"https://upload.wikimedia.org/wikipedia/commons/7/70/Chess_nlt45.svg",b:"https://upload.wikimedia.org/wikipedia/commons/b/b1/Chess_blt45.svg",q:"https://upload.wikimedia.org/wikipedia/commons/1/15/Chess_qlt45.svg",k:"https://upload.wikimedia.org/wikipedia/commons/4/42/Chess_klt45.svg"},b:{p:"https://upload.wikimedia.org/wikipedia/commons/c/c7/Chess_pdt45.svg",r:"https://upload.wikimedia.org/wikipedia/commons/f/ff/Chess_rdt45.svg",n:"https://upload.wikimedia.org/wikipedia/commons/e/ef/Chess_ndt45.svg",b:"https://upload.wikimedia.org/wikipedia/commons/9/98/Chess_bdt45.svg",q:"https://upload.wikimedia.org/wikipedia/commons/4/47/Chess_qdt45.svg",k:"https://upload.wikimedia.org/wikipedia/commons/f/f0/Chess_kdt45.svg"}};function Ws(){const{user:r}=ls(),t=N.useRef(new Ds),e=t.current,[s,i]=N.useState(e.fen()),[o,f]=N.useState([]),[c,p]=N.useState("white"),[d,m]=N.useState("Initializing AI..."),[y,g]=N.useState(!1),[v,E]=N.useState(!1),[$,q]=N.useState(null),[he,B]=N.useState({}),[Y,pe]=N.useState(""),[Se,ue]=N.useState(null);async function Ke(){if(!r)return;let C="Draw";if(e.isCheckmate()){const A=e.turn()==="w"?"Black":"White";C=A==="White"&&c==="white"?"Win":"Loss",A!==(e.turn()==="w"?"Black":"White")&&(C="Loss")}try{await hs(us(fs,`users/${r.uid}/games`),{pgn:e.pgn(),fen:e.fen(),date:ds(),result:C,opponent:"Stockfish AI"}),console.log("Game saved!")}catch(A){console.error("Error saving game:",A)}}function H(C){try{console.log("Attempting move:",C);const A=e.move(C);if(A)return console.log("Move valid:",A),i(e.fen()),f(e.history({verbose:!0})),A;console.warn("Move rejected by chess.js")}catch(A){return console.warn("Exception in safeMakeMove:",A),null}return null}const ge=N.useRef(H);N.useEffect(()=>{ge.current=H});const{speak:ee,cancel:ke,wakeup:Ne}=Vs();N.useEffect(()=>{Y&&Y.trim()!==""&&ee(Y)},[Y,ee]);const te=cs.useRef(null);N.useEffect(()=>{const C=new Us;return te.current=C,C.onMessage(async A=>{if(A.startsWith("bestmove")){const P=A.split(" ")[1];if(P){const T=P.substring(0,2),I=P.substring(2,4),V=P.length>4?P[4]:"q",se=t.current.fen(),ie=t.current.history({verbose:!0}),re=ie.length>0?ie[ie.length-1].san:null,ne=await mt.getMoveCommentary(se,re,P);pe(ne),m("AI Deciding..."),await new Promise(oe=>setTimeout(oe,2500)),m("AI Moving..."),ue(T),await new Promise(oe=>setTimeout(oe,600)),ue(I),await new Promise(oe=>setTimeout(oe,600)),ue(null),ge.current({from:T,to:I,promotion:V}),pe(""),g(!1),m("Your Turn")}}}),m("AI Ready"),()=>{C.quit(),te.current=null,ke()}},[]),N.useEffect(()=>{e.isGameOver()&&!v&&(E(!0),m("Game Over"),Ke())},[s,v]);function Ee(C){if(console.log("Clicked:",C),e.turn()!==c[0]||y||v)return;if($===C){q(null),B({});return}if($){const P=e.get($),I=P&&P.type==="p"&&(P.color==="w"&&C[1]==="8"||P.color==="b"&&C[1]==="1"),V={from:$,to:C};if(I&&(V.promotion="q"),H(V)){q(null),B({}),Ne(),z();return}}const A=e.get(C);if(A&&A.color===c[0]){q(C);const P=e.moves({square:C,verbose:!0}),T={};P.forEach(I=>{T[I.to]={isOption:!0}}),T[C]={isSelected:!0},B(T)}else{B({});return}}N.useEffect(()=>{!e.isGameOver()&&(e.turn()==="w"&&c==="black"||e.turn()==="b"&&c==="white")&&z()},[s,c]);function z(){te.current&&(e.isGameOver()||(g(!0),m("AI Thinking..."),setTimeout(()=>{te.current&&te.current.evaluatePosition(e.fen(),800)},500)))}async function Ce(C){if(v)return;const A=C.toLowerCase().replace(/to/g,"").replace(/ /g,"");if(A.match(/^[a-h][1-8][a-h][1-8]$/)){const I={from:A.substring(0,2),to:A.substring(2,4),promotion:"q"};if(H(I)){z();return}}m("Processing Speech...");const T=await mt.getMoveFromNaturalLanguage(C,e.fen());T?H(T)?z():m("Invalid Move Interpretation"):m("Could not understand command")}const me=["a","b","c","d","e","f","g","h"],Ae=["8","7","6","5","4","3","2","1"],je=c==="white"?Ae:[...Ae].reverse(),_e=c==="white"?me:[...me].reverse(),qe=(C,A,P)=>{const T=`${A}${C}`,I=e.get(T),V=he[T]?.isSelected,se=he[T]?.isOption,ie=Se===T;let re=P?"bg-[#ebecd0]":"bg-[#779556]",ne=null;return V?re="bg-[rgba(255,255,0,0.5)]":ie?re="bg-[rgba(255,165,0,0.7)] shadow-[inset_0_0_20px_rgba(255,165,0,0.8)] transition-all duration-300":se&&(ne=a.jsx("div",{className:"absolute w-3 h-3 bg-[rgba(0,0,0,0.2)] rounded-full"}),I&&(ne=a.jsx("div",{className:"absolute w-full h-full border-4 border-[rgba(0,0,0,0.2)] rounded-full"}))),a.jsxs("div",{onClick:()=>Ee(T),className:`w-full h-full flex items-center justify-center relative cursor-pointer ${re}`,"data-square":T,children:[A===_e[0]&&a.jsx("span",{className:`absolute top-0 left-1 text-[10px] font-bold ${P?"text-[#779556]":"text-[#ebecd0]"}`,children:C}),C===je[7]&&a.jsx("span",{className:`absolute bottom-0 right-1 text-[10px] font-bold ${P?"text-[#779556]":"text-[#ebecd0]"}`,children:A}),I&&a.jsx("img",{src:Qs[I.color][I.type],alt:`${I.color}${I.type}`,className:"w-[85%] h-[85%] select-none pointer-events-none"}),ne]},T)},Fe=()=>{const C=[];for(let A=0;A<8;A++)for(let P=0;P<8;P++){const T=je[A],I=_e[P],V=(A+P)%2===0;C.push(qe(T,I,V))}return C};return a.jsxs("div",{className:"flex flex-col h-full bg-slate-900 text-white p-4 overflow-y-auto",children:[a.jsxs("div",{className:"flex justify-between items-center mb-6",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent",children:"Grandmaster Chess"}),a.jsxs("p",{className:"text-slate-400 text-sm",children:["Powered by Stockfish 16 â€¢ ",d]})]}),a.jsx("div",{className:"flex items-center gap-4",children:a.jsx("div",{className:`px-3 py-1 rounded-full text-xs font-bold ${d==="Your Turn"?"bg-green-500/20 text-green-400":d.includes("Thinking")?"bg-blue-500/20 text-blue-400 animate-pulse":"bg-slate-700 text-slate-400"}`,children:d})})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6 max-w-7xl mx-auto w-full",children:[a.jsxs("div",{className:"lg:col-span-8 flex justify-center relative",children:[Y&&a.jsx("div",{className:"absolute -top-16 left-1/2 transform -translate-x-1/2 z-50 animate-bounce-slow",children:a.jsxs("div",{className:"bg-white text-slate-900 px-6 py-3 rounded-2xl shadow-xl border-2 border-blue-400 relative max-w-sm",children:[a.jsxs("p",{className:"font-bold text-sm italic",children:['"',Y,'"']}),a.jsx("div",{className:"absolute w-4 h-4 bg-white border-b-2 border-r-2 border-blue-400 rotate-45 -bottom-2 left-1/2 -translate-x-1/2"})]})}),a.jsxs("div",{className:"relative aspect-square w-full max-w-[600px] shadow-2xl rounded-lg overflow-hidden border-4 border-slate-700",children:[a.jsx("div",{className:"grid grid-cols-8 grid-rows-8 w-full h-full",children:Fe()}),v&&a.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50",children:a.jsxs("div",{className:"bg-slate-800 p-8 rounded-2xl border border-slate-600 shadow-xl text-center",children:[a.jsx("h2",{className:"text-3xl font-bold mb-2",children:"Game Over"}),a.jsx("p",{className:"text-xl mb-6 text-slate-300",children:e.isCheckmate()?"Checkmate!":"Draw"}),a.jsx("button",{onClick:()=>{e.reset(),i(e.fen()),f([]),E(!1),q(null),B({}),p("white"),m("AI Ready")},className:"bg-blue-600 hover:bg-blue-500 text-white px-6 py-2 rounded-lg font-bold transition-all",children:"Play Again"})]})})]})]}),a.jsxs("div",{className:"lg:col-span-4 space-y-4",children:[a.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 border border-slate-700 h-[300px] flex flex-col",children:[a.jsx("h3",{className:"text-sm font-bold text-slate-400 mb-3 uppercase tracking-wider",children:"Move History"}),a.jsx(Gs,{moves:o})]}),a.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 border border-slate-700 grid grid-cols-2 gap-3",children:[a.jsx("button",{className:"bg-slate-700 hover:bg-slate-600 py-2 rounded text-sm transition-colors",onClick:()=>{e.reset(),i(e.fen()),f([]),E(!1),q(null),B({}),m("AI Ready")},children:"New Game"}),a.jsx("button",{className:"bg-slate-700 hover:bg-slate-600 py-2 rounded text-sm transition-colors",onClick:()=>{p(c==="white"?"black":"white"),q(null),B({}),e.fen()==="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"&&c==="white"&&z()},children:"Switch Sides"})]}),a.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 border border-slate-700",children:[a.jsx("h3",{className:"text-sm font-bold text-slate-400 mb-3 uppercase tracking-wider",children:"Voice Settings"}),a.jsx("div",{className:"flex flex-col gap-3",children:a.jsx(Bs,{onCommand:Ce,isListening:!v})})]})]})]}),a.jsx("div",{className:"hidden"})]})}class Hs extends N.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(t){return{hasError:!0}}componentDidCatch(t,e){console.error("ErrorBoundary caught an error",t,e),this.setState({error:t,errorInfo:e})}render(){return this.state.hasError?a.jsxs("div",{className:"p-6 bg-red-50 border border-red-200 rounded-lg text-center",children:[a.jsx("h2",{className:"text-xl font-bold text-red-700 mb-2",children:"Something went wrong."}),a.jsx("p",{className:"text-red-600 mb-4",children:"We couldn't load this game."}),a.jsxs("details",{className:"text-left bg-white p-4 rounded border border-red-100 text-xs text-red-500 overflow-auto max-h-40",children:[this.state.error&&this.state.error.toString(),a.jsx("br",{}),this.state.errorInfo&&this.state.errorInfo.componentStack]}),a.jsx("button",{className:"mt-4 px-4 py-2 bg-red-100 hover:bg-red-200 text-red-700 rounded transition-colors",onClick:()=>window.location.reload(),children:"Reload Page"})]}):this.props.children}}const _t=[{id:"chess",title:"Grandmaster AI",icon:"smart_toy",component:Ws},{id:"premier",title:"Retail Premier League",icon:"workspace_premium",component:vt},{id:"ramadan",title:"Kindness Quest",icon:"volunteer_activism",component:gs},{id:"green",title:"Sustainability",icon:"eco",component:_s}];function zs(){const[r,t]=N.useState("chess"),e=_t.find(s=>s.id===r)?.component||vt;return a.jsxs("div",{className:"games-page-container fade-in",children:[a.jsx("div",{className:"games-header",children:a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl md:text-4xl font-display font-medium text-brand-navy mb-1 md:mb-2",children:"Gamified Insights"}),a.jsx("p",{className:"text-slate-500 text-sm md:text-lg font-light",children:"Information made fun and interactive."})]})}),a.jsxs("div",{className:"games-layout",children:[a.jsx("div",{className:"games-sidebar",children:_t.map(s=>a.jsxs("button",{className:`game-nav-item ${r===s.id?"active":""}`,onClick:()=>t(s.id),children:[a.jsx("span",{className:"material-symbols-outlined",children:s.icon}),a.jsx("span",{className:"game-nav-label",children:s.title})]},s.id))}),a.jsx("div",{className:"game-display-area",children:a.jsx(Hs,{children:a.jsx(e,{})},r)})]})]})}export{zs as default};
